<html><head>
  <style>
    .banner {
      background-color: #FEF4CC;
      padding: 5px;
      border: 2px solid #D8D8D8;
      text-align: center;
      font-size: 14px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }
  </style>
<meta></head>
<body style="overflow-wrap: break-word;">
  <div class="banner">
    You can no longer change data in DQT - please use the
    <span><a id="trsUrl" href="#" onclick="openTRS(); return false;">TRS Console</a></span>
    for all activities you previously used DQT for
  </div>
  <script type="text/javascript">
    function openTRS() {
      // Environment mapping
      var envMap = {
        "ent-dqt-prod.crm4.dynamics.com": "teaching-record-system.education.gov.uk/persons/",
        "ent-dqt-preprod.crm4.dynamics.com": "preprod.teaching-record-system.education.gov.uk/persons/",
        "ent-dqt-test.crm4.dynamics.com": "test.teaching-record-system.education.gov.uk/persons/",
        "ent-dqt-build.crm4.dynamics.com": "dev.teaching-record-system.education.gov.uk/persons/"
      };
      var defaultUrl = "teaching-record-system.education.gov.uk/persons/";
      // Get the environment-specific base URL
      var host = window.location.hostname.replace(/\.mcas\.ms$/i, "");
      var baseUrl = envMap[host] || defaultUrl;
      // Get record ID
      var recordId = null;
      try {
        if (window.parent && window.parent.Xrm && window.parent.Xrm.Page && window.parent.Xrm.Page.data) {
          recordId = window.parent.Xrm.Page.data.entity.getId();
        }
      } catch (e) {
        console.log('Could not get record ID:', e);
      }
      // Build URL
      var targetUrl;
      if (recordId) {
        recordId = recordId.replace(/[{}]/g, "");
        targetUrl = "https://" + baseUrl + recordId;
      } else {
        targetUrl = "https://" + baseUrl;
      }
      // Open the link
      window.open(targetUrl, '_blank');
    }
  </script>

</body></html>